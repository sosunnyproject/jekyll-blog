---
title: "블록체인: pow pos (스튜디오디센트럴)"
layout: post
categories: dev
date: 2018-07-08T13:01:27-05:00
last_modified_at: 2018-07-08T13:01:27-05:00
share: false
---

> Studio Decentral 유튜버의 PoW, PoS 합의 메커니즘 1,2부 [유튜브 동영상 1부](https://www.youtube.com/watch?v=MGXRy7CQAPE), [2부](https://www.youtube.com/watch?v=3yYn9AbdXiY) 감상하며  정리


# 1부

## 합의 메커니즘
**알아갈 용어들**
- Proof of Work
- Proof of Stake
- Byzantine Generals Problem: 비잔틴 장군 문제
- Sybil Attack: 시빌 공격
- Nothing-at-stake: PoS에 있는 문제
- Hash: PoW 에 있는 문제


중앙 데이터베이스| 비허가성, 분산화 데이터베이스로 옮기는 작업
----------------|------------------------------------------
centralized | permission-less, distributed
신뢰받는 중앙기관이 데이터의 정당성 검증, 이에 따라 업데이트 | 누구나 네트워크에 참가. 누가 업데이트? 어떻게 보호?
 
### 문제: 데이터베이스를 누가 업데이트할 권한을 가지는가?

## 시빌 공격
- 분산화된 P2P네트워크 환경
- 공격자가 많은 가명의 신분을 만들어 과도한 영향력을 행사하는 경우

## 비잔틴 장군 문제
- 1982년에 발표된 논문 주제
  - 비잔틴 제국의 장군들이 각각 다른 위치에서 적군 도시를 에워쌓고 있다. 
  - 전령, 메신저로 소통을 한다.
  - 공동의 계획에 합의해야함 (common plan of action)
  - 조건: 장군 중 몇 명은 배신자일 수 있다. 은근하게, 비밀스럽게 합의를 방해할 수 있다. (멍청하게 대놓고는 안함) 
  - 적군의 방해에 상관없이, 공동의 계획에 합의할 수 있는 알고리즘이 필요하다.
- 분산 네트워크의 보안 문제.
  - 공동의 계획 = 합의
- 비잔틴 문제는 옛날부턴 있던 이론.
- 비잔틴을 응용한 것이 Stellar, Tendermint 방법론.
- 또 다른 방향의 솔루션들은 PoS..
- 즉, 비잔틴 장군을 어떻게 풀까에 대한 각각 다른 해법들이 나오고 있는 것이다.

## PoW, PoS
### PoW
- 나카모토 컨센서스 (consensus: 만장일치 라는 뜻) 라고 불림
- 100% 수학, 100% 똑같은 정답
- 단점: 에너지 소모 크고, 채굴 집중화
  - 한 나라가 쓰는 에너지만큼 비트코인 채굴에 쓰이고 있는 격: 전 세계의 0.06% 에너지가 비트코인에 쓰이고 있다.

### PoS
- **내가 얼마나 Stake 지분을 가지고 있냐** 가 관건
- 보안성이 좋다 
  - 51%의 공격에 대해서는 특히.
  - PoS에 대항해서 해커가 공격을 하려면 전세계 이더리움의 51% 이상을 가져야 하는데, 그건 거의 불가능..
- 비탈릭의 고민거리: **nothing-at-stake** 문제...
  - 경제적 유인 설계가 중요하다.
  - 채굴 위해서는 자기가 소유하고 있는 이더량을 어느정도 묶어둬야 함. 다른 곳에 쓸 수가 없음
  - 그런데도 현실적으로 채굴할 동기가 생기겠는가?
- validator 검증자에 대한 문제
  - 수수료를 얘네가 먹는게 맞는가? 
  - 게임 이론 느낌

### Nothing-at-stake 문제
- Nothing-at-stake **도박으로 치면, 내가 걸어둔 패가 없으니 난 잃을 게 없다** 는 의미
- 이 부분은 **fork** 개념을 알아야 이해가 될 것이다.
- 두 개의 포크에 베팅을 해야 하는 상황을 생각하자.
- 그리고 51%의 공격 상황을 가정하자.
  - PoW: 두 개의 블록체인이 fork가 되었다. 
    - PoW는 하드웨어를 실제로 돌려야 함. 하나의 하드웨어 - 하나의 베팅만 가능.
    - 가능성이 높은 블록체인에다가만 채굴을 하는 것이 효율적
    - 그래서 악의적 네트워크는 자연스레 무시될 것.
    - Orphan block? 동시에 채굴이 될 수도 있긴 하지. 악의성이 아니라 그냥 채굴자들이 동시에 블록이 생길 수도 있지. 그러다가 나중에는 결국 긴 체인으로 합쳐지지. 그래서 큰 문제는 아님. 
  - PoS: 자기가 갖고 있는 것을 거는 시스템
    - 만원으로 두 포크 둘 다 베팅할 수 있다. 이게 본인에게는 최선의 선택일 것.
    - 나쁜 포크가 생겨도 변별성이 떨어짐.
    - Casper: 이 문제에 대해서 뷰탈린이 내놓은 해결책
- Casper, Tendermint 해결책들은 강한 경제적 유인을 주려고 하는 것.
- 트랜잭션 속도랑 연결해서 굳이 생각할 필요는...
- 핵심은 검증의 변별성이 떨어지냐 아니냐.

### PoW: Hash 연산 특징

- 입력값+nonce --> Hash 연산 함수 --> 출력값
  - 법칙1: 입력값 한자리만 바뀌어도 출력값이 완전히 다름.
  - 법칙2: 입력값이 동일하면 출력값도 동일하다.
- 채굴기는 입력값과 출력값을 보고 nonce를 맞추는 게 일.
- 작업증명: 입력값, 찾은 nonce를 넣어서 출력을 해보면 '아 얘가 일을 했네' 증명이 되는 셈이니까 **작업증명**
- 이거 만든 사람은 아담 백: BlockStream CEO, HashCash, 사토시 논문에 인용되어 있음
- **Gossip Network** : 작업증명으로써 네트워크의 다른 노드들한테 내가 nonce 찾았다고 뿌려댄다.


여담
- 비탈릭이 실험을 많이 함.
- 오픈된 방식으로 토론을 많이 함. 집단 지성 활용.
- 약간 완벽주의 같음. 
- 시장에서 원하는 적당한 레벨 vs 완벽주의를 위한 딜레이..
- Casper에 영향력이 쎈 비탈릭과 Vlad Zamfir 의 의견, 백그라운드가 다소 다름.
- 노드가 많을 수록 좋은 것: 하나면 그냥 가서 꺼버리면 그만. 여러개가 있어야지 보안성이 높아지는 것.
- 그래도 어느 정도 노드 수를 제한을 해야되긴 함.(Tendermint는 제한함)
  - 의견이 분분
  - 너무 많으면 합의 이끌어내기가 어려울 수 있어서.
- 여기서 '노드' - validator 의미로 말한거였음.


# 2부

youtube- pow pos block 12 studio decentral
### PoW, PoS
- PoS: Proof of Stake: 자산을 많이 가진 사람에게 분산화된 비허가성 데이터 베이스인 블록체인을 업데이트하기 위한 권한을 부여하는 합의 매커니즘이다. 자산 증명. (작업증명은 PoW)
- consensus by bet: 자산이 가장 큰 블록체인을 가장 정당한 valid한 블체로 하기로 함 consensus, 베팅을 가장 많이 받은 블록을 인정해준다.
- validator들의 자산 증명 리스트: A 자산 xx, B 자산 xx, 이 블록을 정당하다고 인정하는 사람들의 리스트가 있음.
그 validator들의 자산이 가장 큰 블록이 정당한 블록체인으로 인정됨.
- 작업증명- 일이 가장 많이 들어간 체인을 인정해줌
- tendermint:도 동일한 개념.
- 왜 stake 위주야??
  - 이 시스템에 stake가 많은 사람들
  - 내가 지분이 많을 수록 이 화폐의 가치가 떨어지는게 싫잖아. 
  - 화폐의 생태계에 도움이 되는 방향으로 가고 싶을 테니까.


- PoW : 전세계 채굴 연산량 51% 이상 보유
- PoS : 전세계 자산의 51% 이상 보유 
- PoS의 51% 금액 > PoW 51%
- 사회적인 문제.. 어떻게 자신의 자산, 권력을 활용/횡포할까
- 아담 백- 해쉬 캐쉬 때 이미 PoW가 있었다 - 이걸 블록체인과 합치니까 와우
- PoS 시스템마다 그냥 보유만 해도 되거나 노드 역할에 참여하거나 규약이 다름

- PoS: virtualize 채굴 이라고 생각.
- 채굴자가 반대한다고 해도 비탈릭 PoS testnet에서 돌려보고 하겠다고 하면 걍 하는 거임.
- PoS 문제점: virtualize 환경이기 때문에 내 자산을 나눠서 두개로 해서 proof 계속 찍어낼수도 있다는 사기 리스크
- (단기공격) 이중지불공격 가능: 적은 비용으로도 공격이 가능. validator 입장에서는 뭐가 인증될지 모르고, 어느 경우에나 보상을 받을테니까 그냥 둘 다에다가 베팅. 혼란, 남발 리스크
- PoS 검증 과정: 컴퓨팅 파워는 거의 안든다고 보면 됨. 그냥 싸인하는거임
- PoS 벌금: 이더는 그냥 버닝, tendermint는 클레이머에게 돌아감.


CASPER
- nothing at stake: 검증자가 잘못된 선택을 하더라도 잃을 것이 없다. 그래서 이더리움의 PoS 알고리즘(Casper)에서는 보증금 security deposit, penalty 통해 해결하려고 하고 있다. 검증자가 되기 위해서 보증금을 넣어놓고 벌금 물릴 수 있음.
- 자산 증명, validator 되기 위해서는..
  - bonding: 예치: bonded validator가 되어야 한다. (30:22)

  
  
  
